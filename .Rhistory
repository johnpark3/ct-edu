rename('Percent_1617' = '% of Total_2') %>%
rename('Count_1718' = 'Count_3') %>%
rename('Percent_1718' = '% of Total_3') %>%
rename('Count_1819' = 'Count_4') %>%
rename('Percent_1819' = '% of Total_4') %>%
dplyr::filter(.$'District' %in% nh_dists$'district')
read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3)
read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3) %>%
mutate_at(c("District", "School"), na.locf)
nh_dists$'district'
nh_staffrace <- read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3) %>%
mutate_at(c("District", "School"), na.locf) %>%
rename('Count_1415' = 'Count') %>%
rename('Percent_1415' = '% of Total') %>%
rename('Count_1516' = 'Count_1') %>%
rename('Percent_1516' = '% of Total_1') %>%
rename('Count_1617' = 'Count_2') %>%
rename('Percent_1617' = '% of Total_2') %>%
rename('Count_1718' = 'Count_3') %>%
rename('Percent_1718' = '% of Total_3') %>%
rename('Count_1819' = 'Count_4') %>%
rename('Percent_1819' = '% of Total_4') %>%
sapply(gsub, pattern = "=", rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
na_if(".") %>%
dplyr::filter(.$'District' %in% nh_dists$'district') %>%
rename('district' = "District") %>%
right_join(nh_dists, by = 'district') %>%
write_rds(nh_staffrace, here("edsight/outputs", "staff_race.rds"))
right_join(nh_dists, by = 'district)
nh_staffrace <- read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3) %>%
mutate_at(c("District", "School"), na.locf) %>%
rename('Count_1415' = 'Count') %>%
nh_staffrace <- read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3) %>%
nh_perf <- read_csv(here("edsight/raw_data", "performanceindex.csv"), skip = 8) %>%
rename('ELA_1516' = 'ELAPerformanceIndex') %>%
rename('Math_1516' = 'MathPerformanceIndex') %>%
rename('Sci_1516' = 'SciencePerformanceIndex') %>%
rename('ELA_1617' = 'ELAPerformanceIndex_1') %>%
rename('Math_1617' = 'MathPerformanceIndex_1') %>%
rename('Sci_1617' = 'SciencePerformanceIndex_1') %>%
rename('ELA_1718' = 'ELAPerformanceIndex_2') %>%
rename('Math_1718' = 'MathPerformanceIndex_2') %>%
rename('Sci_1718' = 'SciencePerformanceIndex_2') %>%
dplyr::filter(.$'District Name' %in% nh_dists$'district') %>%
rename('district' = "District Name") %>%
right_join(nh_dists, by = 'district') %>%
sapply(gsub, pattern = "=", rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
na_if('*') %>%
na_if("N/A")
source("../_utils/edsight_functions.R")
nh_dists <- school_dists %>%
dplyr::filter(region %in% c("New Haven Inner Ring", "New Haven Outer Ring")) %>%
rbind(c("New Haven Inner Ring", "New Haven"))
nh_dists$district <- nh_dists$district %>%
paste("School District")
nh_perf <- read_csv(here("edsight/raw_data", "performanceindex.csv"), skip = 8) %>%
rename('ELA_1516' = 'ELAPerformanceIndex') %>%
rename('Math_1516' = 'MathPerformanceIndex') %>%
rename('Sci_1516' = 'SciencePerformanceIndex') %>%
rename('ELA_1617' = 'ELAPerformanceIndex_1') %>%
rename('Math_1617' = 'MathPerformanceIndex_1') %>%
rename('Sci_1617' = 'SciencePerformanceIndex_1') %>%
rename('ELA_1718' = 'ELAPerformanceIndex_2') %>%
rename('Math_1718' = 'MathPerformanceIndex_2') %>%
rename('Sci_1718' = 'SciencePerformanceIndex_2') %>%
dplyr::filter(.$'District Name' %in% nh_dists$'district') %>%
rename('district' = "District Name") %>%
right_join(nh_dists, by = 'district') %>%
sapply(gsub, pattern = "=", rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
na_if('*') %>%
na_if("N/A")
write_rds(nh_perf, here("edsight/outputs", "perf_index.rds"))
nh_staffrace <- read_csv(here("edsight/raw_data", "staffing_race.csv"), skip = 3) %>%
mutate_at(c("District", "School"), na.locf) %>%
rename('Count_1415' = 'Count') %>%
rename('Percent_1415' = '% of Total') %>%
rename('Count_1516' = 'Count_1') %>%
rename('Percent_1516' = '% of Total_1') %>%
rename('Count_1617' = 'Count_2') %>%
rename('Percent_1617' = '% of Total_2') %>%
rename('Count_1718' = 'Count_3') %>%
rename('Percent_1718' = '% of Total_3') %>%
rename('Count_1819' = 'Count_4') %>%
rename('Percent_1819' = '% of Total_4') %>%
sapply(gsub, pattern = "=", rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
na_if(".") %>%
dplyr::filter(.$'District' %in% nh_dists$'district') %>%
rename('district' = "District") %>%
right_join(nh_dists, by = 'district')
write_rds(nh_staffrace, here("edsight/outputs", "staff_race.rds"))
nh_staffrace
nh_absent <- read_csv(here("edsight/raw_data", "chronicAbsenteeism.csv"), skip = 4) %>%
sapply(gsub, pattern = "=", rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
sapply(gsub, pattern = '"', rep = "") %>%
as_tibble %>%
na_if("*") %>%
na_if("N/A") %>%
dplyr::filter(.$'District' %in% nh_dists$'district') %>%
rename('district' = "District") %>%
right_join(nh_dists, by = 'district')
write_rds(nh_absent, here("edsight/outputs", "absenteeism.rds"))
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1819) %>%
mutate_at(c('Percent_1819'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1819) %>%
select(-Race)
nh_staffrace
intersect(nh_staffrace$`School`, nh_perf$`School Name`)
nh_perf$`School Name`
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1819) %>%
mutate_at(c('Percent_1819'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1819) %>%
select(-Race)
intersect(nh_staffrace$`School`, nh_perf$`School Name`)
intersect(nh_staffrace$`School`, nh_perf$`School`)
nh_staffrace$`School` !%in% nh_perf$`School`
!(nh_staffrace$`School` %in% nh_perf$`School`)
nh_staffrace$`School` %in% nh_perf$`School`
nh_staffrace$`School[nh_staffrace$`School` %in% nh_perf$`School`]
nh_staffrace[nh_staffrace$`School` %in% nh_perf$`School`]
nh_perf$School %in% nh_staffrace$School
!(nh_perf$School %in% nh_staffrace$School)
a <- c("a", "b", "c")
b <- c("z", "a")
a %in% b
b %in% a
a %in% b
!(nh_perf$School %in% nh_staffrace$School)
nh_perf$!(nh_perf$School %in% nh_staffrace$School)
nh_perf[!(nh_perf$School %in% nh_staffrace$School)]
nh_perf %>%
select(!(nh_perf$School %in% nh_staffrace$School))
nh_perf %>%
filter(!(nh_perf$School %in% nh_staffrace$School))
nh_perf_uniqueschools <- nh_perf %>%
filter(!(nh_perf$School %in% nh_staffrace$School)) %>%
select(School)
# schools in nh_perf but not in nh_staffrace
nh_perf_uniqueschools <- nh_perf %>%
filter(!(nh_perf$School %in% nh_staffrace$School)) %>%
select(School)
dim(nh_perf_uniqueschools)
intersect(nh_perf$School, nh_staffrace$School)
nh_perf$School
nh_perf_staffrace <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
nh_perf_staffrace
dim(nh_perf_staffrace)
nh_perf_staffrace <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
nh_perf_staffrace
nh_perf_staffrace <- nh_perf_staffrace %>%
drop_na
dim(nh_perf_staffrace) # 125 schools
nh_perf_staffrace
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat
ggplot(dat, aes(School, ELA_1718)) +
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
select(n=10)
ggplot(dat, aes(School, ELA_1718)) +
n(10)
ggplot(dat, aes(School, ELA_1718)) +
n(10)+
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
top_n(10) +
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
top_n(10, ELA_1718) +
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
top_n(n=10, wt=ELA_1718) +
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
top_n(x=dat, n=10, wt=ELA_1718) +
geom_point()
ggplot(dat, aes(School, ELA_1718)) +
top_n(x=dat$ELA_1718, n=10) +
geom_point()
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1719) %>%
mutate_at(c('Percent_1719'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1819) %>%
select(-Race)
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1819) %>%
select(-Race)
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1718) %>%
select(-Race)
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric) %>%
rename(ELA = ELA_1718) %>%
rename(Math = Math_1718)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1718) %>%
select(-Race)
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat
ggplot(dat, aes(School, ELA_1718)) +
top_n(x=dat$ELA_1718, n=10) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(10) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(x=dat, n=10) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(x=dat$ELA, n=10) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(x=dat, n=10) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(x=dat, n=10, wt=ELA) +
geom_point()
ggplot(dat, aes(School, ELA)) +
top_n(n=10, wt=ELA) +
geom_point()
dat %>%
top_n(n=10, wt=ELA) %>%
ggplot(dat, aes(School, ELA)) + geom_point()
dat %>%
top_n(n=10, wt=ELA) %>%
ggplot(aes(School, ELA)) + geom_point()
dat %>%
top_n(n=10, wt=`School Code`) %>%
ggplot(aes(School, ELA)) + geom_point() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head() %>%
ggplot(aes(School, ELA)) + geom_point() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head(15) %>%
ggplot(aes(School, ELA)) + geom_point() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
knitr::opts_chunk$set(
echo = FALSE,
fig.showtext = TRUE,
message = FALSE,
warning = FALSE,
dpi = 300,
fig.width = 7,
fig.height = 5
)
source("../_utils/edsight_functions.R")
nh_dists <- school_dists %>%
dplyr::filter(region %in% c("New Haven Inner Ring", "New Haven Outer Ring")) %>%
rbind(c("New Haven Inner Ring", "New Haven"))
nh_dists$district <- nh_dists$district %>%
paste("School District")
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric) %>%
rename(ELA = ELA_1718) %>%
rename(Math = Math_1718)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(`Percent White` = Percent_1718) %>%
select(-Race)
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat %>%
head(15) %>%
ggplot(aes(School, ELA)) + geom_point() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head(15) %>%
ggplot(aes(School, ELA)) +
geom_point(aes(color = district)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
tail(15) %>%
ggplot(aes(School, ELA)) +
geom_point(aes(color = district)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head(15) %>%
ggplot(aes(School, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head(15) %>%
ggplot(aes(School, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
head(15) %>%
ggplot(aes(`Percent White`, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(`Percent White`, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
nh_perf <- readRDS(here("edsight/outputs/", "perf_index.rds")) %>%
rename(School = `School Name`) %>%
select(region, district, `District Code`, School, `School Code`, ELA_1718, Math_1718) %>%
mutate_at(c('ELA_1718'), as.numeric) %>%
mutate_at(c('Math_1718'), as.numeric) %>%
rename(ELA = ELA_1718) %>%
rename(Math = Math_1718)
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(white = Percent_1718) %>%
select(-Race)
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat %>%
order(white)
dat %>%
order(dat$white)
dat %>%
arrange(white)
dat %>%
arrange(-white) %>%
head
nh_staffrace <- readRDS(here("edsight/outputs/", "staff_race.rds")) %>%
select(district, School, region, Race, Percent_1718) %>%
mutate_at(c('Percent_1718'), as.numeric) %>%
filter(`Race` == "White") %>%
rename(white = Percent_1718) %>%
select(-Race) %>%
filter(School != "Fair Haven School") # outlier
dat <- inner_join(nh_perf, nh_staffrace, join = c(`district`, `School`))
dim(dat) # 125 schools
dat <- dat %>%
drop_na
dim(dat) # 110 schools
dat %>%
arrange(-white) %>%
head
dat %>%
ggplot(aes(`Percent White`, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) %>%
jitter(10)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
jitter(10)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter(10)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter()
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter(width=10)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter(width=2)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter(width=0)
dat
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter(width=1)
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region)) +
geom_jitter(width=1) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region), jitter=1) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region), jitter=10) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_point(aes(color = region), jitter=10) +
theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
geom_jitter()
dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = 1) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = 0) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = .5) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
ggsave(plot1, "ELA_percentwhite")
plot1 <- dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = .5) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
ggsave(plot1, "ELA_percentwhite")
ggsave("ELA_percentwhite.png")
plot1 <- dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = .5) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, ELA)) +
geom_jitter(aes(color = region), width = .5) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
dat %>%
ggplot(aes(white, Math)) +
geom_jitter(aes(color = region), width = .5) +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
