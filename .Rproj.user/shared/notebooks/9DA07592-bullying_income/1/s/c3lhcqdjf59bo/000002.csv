"0","df1 <- read_csv(here(""edsight/raw_data"", ""bullying1318.csv""), skip=4) %>% "
"0","  select(-`District Code`)"
"0","# df2 <- read_csv(here(""edsight/raw_data"", ""bullying1213.csv""), skip=4) %>% "
"0","#   gather(`Bullying Type`, '2012-13', 3:4) %>% "
"0","#   rename(`District` = `DISTRICT`) %>% "
"0","#   arrange(District) %>% "
"0","#   select(-`District Code`)"
"0","# df <- left_join(df1, df2) %>% "
"0","df <- df1 %>% "
"0","  gather(`year`, value, '2013-14':'2017-18') %>% "
"0","  dplyr::filter(.$'District' %in% nh_dists$'district') %>% "
"0","  rename('district' = ""District"") %>% "
"0","  right_join(nh_dists, by = 'district') %>% "
"0","  drop_na() %>% # 152, 5 // 130, 5"
"0","  mutate_at('year', str_sub, start=1, end=4) %>% # first year of the school year"
"0","  mutate_at('year', as.numeric) %>% "
"0","  mutate_at(""district"", str_replace, pattern = "" School District"", replacement = """") %>% "
"0","  arrange(district, year) %>% "
"0","  rename(type = `Bullying Type`)"
"0","df_high <- df %>% "
"0","  mutate_at(""value"", str_replace, pattern = ""\\*"", replacement = ""5"") %>% "
"0","  mutate_at(""value"", as.numeric) %>% "
"0","  group_by(district, type) %>% "
"0","  mutate(fouryr_val_high = sum(value)) %>% "
"0","  ungroup() %>% "
"0","  filter(year == 2017) %>% "
"0","  select(ring, district, type, fouryr_val_high)"
"0","df_low <- df %>% "
"0","  mutate_at(""value"", str_replace, pattern = ""\\*"", replacement = ""0"") %>% "
"0","  mutate_at(""value"", as.numeric) %>% "
"0","  group_by(district, type) %>% "
"0","  mutate(fouryr_val_low = sum(value)) %>% "
"0","  ungroup() %>% "
"0","  filter(year == 2017) %>% "
"0","  select(ring, district, type, fouryr_val_low)"
"0","df_high_low <- bind_cols(df_high, df_low) %>% "
"0","  filter(type == ""Number of students with at least 1 bullying incident"") %>% "
"0","  select(ring, district, fouryr_val_low, fouryr_val_high)"
"0","regions2 <- data.frame("
"0","  region = c(""Hamden, Ansonia,\nSeymour, Derby,\nWoodbridge & Bethany"", "
"0","              ""East Haven, Branford,\nGuilford, Madison,\n& North Branford"","
"0","              ""West Haven,\nMilford & Orange"","
"0","              ""New Haven"""
"0","             )"
"0",") %>% lapply(as.character) %>% as_tibble()"
"0","df_high_low2 <- regions2 %>% "
"0","  fuzzyjoin::regex_right_join(df_high_low, by = c(""region"" = ""district"")) %>% "
"0","  group_by(region) %>% "
"0","  mutate(median_low = median(fouryr_val_low)) %>% "
"0","  mutate(median_high= median(fouryr_val_high)) %>% "
"0","  ungroup()"
