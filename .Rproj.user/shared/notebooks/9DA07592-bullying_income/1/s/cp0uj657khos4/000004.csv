"0","quants2 <- svyby(~hhincome, ~region, income_des, svyquantile, quantiles = c(0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9), keep.var = F) %>%"
"0","  as.data.frame() %>%"
"0","  as_tibble() %>%"
"0","  setNames(c(""region"", ""q20"", ""q30"", ""q40"", ""q50"", ""q60"", ""q70"", ""q80"",""q90"")) %>%"
"0","  mutate_if(is.numeric, round) %>%"
"0","  mutate(ratio90_20 = round(q90 / q20, digits = 3)) %>% "
"0","  mutate(ratio80_20 = round(q80 / q20, digits = 3)) %>%"
"0","  mutate(ratio70_20 = round(q70 / q20, digits = 3)) %>% "
"0","  mutate(ratio60_20 = round(q60 / q20, digits = 3)) %>%"
"0","  mutate(ratio50_20 = round(q50 / q20, digits = 3)) %>% "
"0","  mutate(ratio40_20 = round(q40 / q20, digits = 3)) %>%"
"0","  mutate(ratio30_20 = round(q30 / q20, digits = 3)) %>% "
"0","  mutate(ratio20_20 = round(q20 / q20, digits = 3)) %>% "
"0","  mutate_at(""region"", str_replace, pattern = "" Towns"", replacement = """") %>% "
"0","  mutate_at(""region"", str_replace, pattern = "" Town"", replacement = """") %>% "
"0","  mutate_at(""region"", str_replace, pattern = ""East Haven, Branford, Guilford, Madison & North Branford"", replacement = ""East Haven, Branford,\nGuilford, Madison,\n& North Branford"") %>% "
"0","  mutate_at(""region"", str_replace, pattern = ""Hamden, Ansonia, Seymour, Derby, Woodbridge & Bethany"", replacement = ""Hamden, Ansonia,\nSeymour, Derby,\nWoodbridge & Bethany"") %>% "
"0","  mutate_at(""region"", str_replace, pattern = ""West Haven, Milford & Orange"", replacement = ""West Haven,\nMilford & Orange"") %>% "
"0","  gather(percentile, value, ratio90_20:ratio20_20) %>% "
"0","  select(-(q20:q90)) %>% "
"0","  mutate_at('percentile', substr, start=6, stop=7) %>% "
"0","  mutate_at('percentile', as.numeric)"
