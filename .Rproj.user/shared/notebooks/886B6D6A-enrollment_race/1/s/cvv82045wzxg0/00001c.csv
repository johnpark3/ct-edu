"0","df1 <- map_dfr (names, function(name) { "
"0","  readRDS(here(""ctsde/outputs"", str_glue(""enrollment_race_{name}.rds"")))"
"0","  }"
"0","  )"
"0","df1 <- df1 %>% "
"0","  as_tibble() %>% "
"0","  "
"0","  mutate_at('Value', as.numeric) %>% "
"0","  na_if(-9999) %>% "
"0","  mutate_all(funs(ifelse(is.na(.), 0, .))) %>% "
"0","  "
"0","  dplyr::filter(.$'District' %in% nh_dists$'district') %>% "
"0","  rename('district' = ""District"") %>% "
"0","  right_join(nh_dists, by = 'district') %>% "
"0","  "
"0","  # create, student white count, student total count"
"0","  group_by(district, Year) %>% "
"0","  mutate(student_total_count = sum(Value)) %>% "
"0","  ungroup() %>% "
"0","  dplyr::filter(`Race/Ethnicity` == ""White"") %>% "
"0","  rename(student_white_count = Value) %>% "
"0","  "
"0","  # convert year to numeric"
"0","  rename(year = Year) %>% "
"0","  mutate_at('year', str_sub, start=1, end=4) %>% "
"0","  mutate_at('year', as.numeric) %>% "
"0","  "
"0","  select(region, district, year, student_white_count, student_total_count)"
"0","# Create and bind Greater New Haven row"
"0","gnh1 <- df1 %>% "
"0","  group_by(year) %>% "
"0","  summarise_each(funs(sum), student_white_count, student_total_count) %>% "
"0","  ungroup() %>% "
"0","  mutate(region = ""NA"", district = ""Greater New Haven"") %>% "
"0","  select(region, district, year, student_white_count, student_total_count)"
"0","df1 <- df1 %>% bind_rows(gnh1)"
"0","dim(df1)"
"1","[1]"
"1"," 112"
"1","   5"
"1","
"
